<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‚öΩ E-Football League Table (Live)</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f0f4f8;
    margin: 0;
    padding: 10px;
  }
  .container {
    max-width: 600px;
    width: 100%;
    margin: auto;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    position: relative;
  }
  .admin-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
    z-index: 10;
    transition: background 0.3s;
  }
  .admin-toggle:hover { background: #2980b9; }
  .header {
    background: linear-gradient(90deg,#1e3c72,#2a5298);
    padding: 20px 10px 10px;
    color: #fff;
    text-align: center;
  }
  .header h1 { margin: 0; font-size: 20px; text-transform: uppercase; }
  .header p { font-size: 12px; margin: 5px 0 0; }
  .top-player {
    text-align: center;
    margin-top: 10px;
  }
  .top-player img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid gold;
    object-fit: cover;
    animation: pulse 1s ease;
  }
  .top-player p {
    margin: 5px 0 0;
    font-weight: bold;
    color: #2c3e50;
  }
  .admin-section {
    display: none;
    padding: 10px;
    background: #eef6fc;
    text-align: center;
    animation: slideDown 0.3s ease;
  }
  .admin-section input {
    width: 70%;
    padding: 6px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 5px;
  }
  .admin-section button {
    width: 25%;
    padding: 6px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
  }
  .admin-section button:hover { background: #2980b9; }
  .form-section {
    padding: 10px;
    display: none;
    flex-wrap: wrap;
    gap: 5px;
    animation: fadeIn 0.5s ease;
  }
  .form-section select, .form-section input {
    flex: 1 1 48%;
    padding: 6px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  .form-section button {
    width: 100%;
    padding: 8px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
  }
  .form-section button:hover { background: #2980b9; }
  .description {
    background: #eaf3fc;
    color: #2c3e50;
    padding: 8px;
    text-align: center;
    font-size: 12px;
    border-bottom: 1px solid #ccc;
    animation: fadeIn 0.5s ease;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    opacity: 0;
    animation: fadeIn 1s ease forwards;
    animation-delay: 0.3s;
  }
  th, td {
    padding: 6px;
    border: 1px solid #ddd;
    text-align: center;
  }
  th {
    background: #2c3e50;
    color: white;
    font-size: 13px;
  }
  .footer {
    text-align: center;
    font-size: 10px;
    color: #777;
    padding: 8px 0 10px;
    animation: fadeIn 0.5s ease;
  }
  @media (max-width: 480px) {
    .admin-toggle {
      top: 5px;
      right: 5px;
      font-size: 10px;
      padding: 3px 6px;
    }
    .header h1 { font-size: 16px; }
    .header p { font-size: 10px; }
    .top-player img { width: 80px; height: 80px; }
    .form-section select, .form-section input { flex: 1 1 100%; }
    th, td { font-size: 11px; padding: 4px; }
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px);}
    to { opacity: 1; transform: translateY(0);}
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }
</style>
</head>
<body>
<div class="container">
  <button class="admin-toggle" onclick="toggleAdmin()">üîë Admin</button>

  <div class="header">
    <h1>üéÆ E-Football Tournament 2025</h1>
    <p>Live & Shared Table | Admin-protected</p>
  </div>

  <div class="admin-section" id="adminSection">
    <input type="password" id="adminCode" placeholder="Enter admin code">
    <button onclick="checkAdmin()">OK</button>
  </div>

  <div class="top-player" id="topPlayer" style="display:none;">
    <img src="" alt="Top Player" id="topPlayerImg">
    <p id="topPlayerName"></p>
  </div>

  <div class="form-section" id="addForm">
    <select id="teamA">
      <option>Ezaz</option><option>Surjo</option><option>Uchas</option>
      <option>Mafid</option><option>Kakon</option><option>Shami</option>
    </select>
    <input type="number" id="scoreA" placeholder="Goals A">
    <select id="teamB">
      <option>Ezaz</option><option>Surjo</option><option>Uchas</option>
      <option>Mafid</option><option>Kakon</option><option>Shami</option>
    </select>
    <input type="number" id="scoreB" placeholder="Goals B">
    <button onclick="addResult()">‚ûï Add Result</button>
  </div>

  <div class="description" id="loadingMessage">‚è≥ Loading table, please wait...</div>
  <div class="description" id="tableDescription" style="display:none;">
    üèÜ Live League Table Updated for Everyone!
  </div>

  <table id="pointsTable">
    <thead>
      <tr>
        <th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th>
        <th>GF</th><th>GA</th><th>GD</th><th>Pts</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="footer">Updated Live | Built by Ezaz üíª</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyQdeHLEnyE4uYfaZCjHBJjuUzrmvJG3iZucUyHAv2Z8wE1NeKFwJ4FvR2F3V8Szj2jtg/exec";
const SECRET_CODE = "29292929";

const playerImages = {
  "Kakon": "https://i.imgur.com/XhONWgL.png",
  // add others later
};

function toggleAdmin() {
  const section = document.getElementById("adminSection");
  section.style.display = section.style.display === "block" ? "none" : "block";
}

function checkAdmin() {
  const input = document.getElementById("adminCode").value;
  if (input === SECRET_CODE) {
    document.getElementById("addForm").style.display = "flex";
    document.getElementById("adminSection").style.display = "none";
    alert("‚úÖ Admin mode enabled!");
  } else {
    alert("‚ùå Wrong code!");
  }
}

async function loadTable() {
  document.getElementById("loadingMessage").style.display = "block";
  document.getElementById("tableDescription").style.display = "none";

  try {
    const res = await fetch(API_URL + "?method=getTable");
    const data = await res.json();
    const tbody = document.querySelector("#pointsTable tbody");
    tbody.innerHTML = "";

    const teams = [];
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      teams.push({
        name: row[0],
        played: Number(row[1]),
        win: Number(row[2]),
        draw: Number(row[3]),
        loss: Number(row[4]),
        gf: Number(row[5]),
        ga: Number(row[6]),
        gd: Number(row[7]),
        pts: Number(row[8])
      });
    }

    teams.sort((a, b) => b.pts - a.pts || b.gd - a.gd || b.gf - a.gf);

    const top = teams[0];
    if(top && playerImages[top.name]) {
      document.getElementById("topPlayerImg").src = playerImages[top.name];
      document.getElementById("topPlayerName").textContent = `üèÜ Current Top Player: ${top.name}`;
      document.getElementById("topPlayer").style.display = "block";
    } else {
      document.getElementById("topPlayer").style.display = "none";
    }

    for (const t of teams) {
      tbody.innerHTML += `<tr>
        <td>${t.name}</td><td>${t.played}</td><td>${t.win}</td>
        <td>${t.draw}</td><td>${t.loss}</td><td>${t.gf}</td>
        <td>${t.ga}</td><td>${t.gd}</td><td>${t.pts}</td>
      </tr>`;
    }

    document.getElementById("loadingMessage").style.display = "none";
    document.getElementById("tableDescription").style.display = "block";
  } catch (e) {
    document.getElementById("loadingMessage").textContent = "‚ùå Failed to load table.";
    console.error(e);
  }
}

async function addResult() {
  const a = document.getElementById("teamA").value;
  const b = document.getElementById("teamB").value;
  const gA = parseInt(document.getElementById("scoreA").value);
  const gB = parseInt(document.getElementById("scoreB").value);
  if (a === b || isNaN(gA) || isNaN(gB)) return alert("Invalid input!");

  const res = await fetch(API_URL + "?method=getTable");
  const data = await res.json();
  const teams = {};
  for (let i = 1; i < data.length; i++) {
    const r = data[i];
    teams[r[0]] = { played:Number(r[1]), win:Number(r[2]), draw:Number(r[3]), loss:Number(r[4]), gf:Number(r[5]), ga:Number(r[6]), gd:Number(r[7]), pts:Number(r[8]) };
  }

  updateStats(teams[a], gA, gB);
  updateStats(teams[b], gB, gA);

  await updateTeam(a, teams[a]);
  await updateTeam(b, teams[b]);
  loadTable();
}

function updateStats(t, gf, ga) {
  t.played++;
  t.gf += gf;
  t.ga += ga;
  t.gd = t.gf - t.ga;
  if (gf > ga) { t.win++; t.pts += 3; }
  else if (gf === ga) { t.draw++; t.pts += 1; }
  else { t.loss++; }
}

async function updateTeam(name, s) {
  const params = new URLSearchParams({
    method: "updateTeam", teamName: name,
    played: s.played, win: s.win, draw: s.draw, loss: s.loss,
    gf: s.gf, ga: s.ga, gd: s.gd, pts: s.pts
  });
  await fetch(API_URL + "?" + params.toString());
}

loadTable();
</script>
</body>
</html>
