<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‚öΩ E-Football Points Table</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    margin: 0; padding: 20px;
  }
  h1 {
    text-align: center; color: #333; margin-bottom: 30px;
  }
  .group-table {
    max-width: 900px;
    margin: 20px auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 20px;
  }
  .group-table h2 {
    background-color: #007bff;
    color: white;
    margin: -20px -20px 15px -20px;
    padding: 10px;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    font-size: 1.3rem;
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }
  th {
    background-color: #e9ecef;
  }
  tr:nth-child(even) {
    background-color: #f8f9fa;
  }
  #errorMsg {
    color: red;
    text-align: center;
    font-weight: bold;
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>üìä E-Football Group Points Table</h1>
<div id="tables"></div>
<div id="errorMsg"></div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbww08i4GpfL0bdVxNJq1E-K0G0eGiiXk9iD6N_OkMe88LXZFGlvEIlkeH5NGe9edbk3/exec";
  let cachedData = null;

  async function loadPoints() {
    const container = document.getElementById('tables');
    const errorMsg = document.getElementById('errorMsg');
    container.innerHTML = "‚è≥ Loading points...";
    errorMsg.textContent = "";

    try {
      if (!cachedData) {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 7000); // 7 sec timeout

        const response = await fetch(SCRIPT_URL, { mode: "cors", signal: controller.signal });
        clearTimeout(timeoutId);

        if (!response.ok) throw new Error("Network response was not ok");

        cachedData = await response.json();
      }

      const data = cachedData;

      // Group by 'Group' client-side
      const grouped = data.reduce((acc, item) => {
        const grp = item.Group || "Unknown";
        if (!acc[grp]) acc[grp] = [];
        acc[grp].push(item);
        return acc;
      }, {});

      container.innerHTML = "";

      for (const group in grouped) {
        const teams = grouped[group];

        const groupDiv = document.createElement('div');
        groupDiv.className = 'group-table';

        const groupTitle = document.createElement('h2');
        groupTitle.textContent = `üÖ∂ Group ${group}`;
        groupDiv.appendChild(groupTitle);

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th>Team</th>
            <th>P</th>
            <th>W</th>
            <th>D</th>
            <th>L</th>
            <th>GF</th>
            <th>GA</th>
            <th>GD</th>
            <th>Pts</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        teams.forEach(team => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${team.Team}</td>
            <td>${team.P}</td>
            <td>${team.W}</td>
            <td>${team.D}</td>
            <td>${team.L}</td>
            <td>${team.GF}</td>
            <td>${team.GA}</td>
            <td>${team.GD}</td>
            <td>${team.Pts}</td>
          `;
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        groupDiv.appendChild(table);
        container.appendChild(groupDiv);
      }

    } catch (error) {
      container.innerHTML = "";
      if (error.name === 'AbortError') {
        errorMsg.textContent = "‚è≥ Loading timed out. Please try again.";
      } else {
        errorMsg.textContent = "‚ùå Failed to load data.";
      }
      console.error("Error fetching points:", error);
    }
  }

  window.onload = loadPoints;
</script>

</body>
</html>
